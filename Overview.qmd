---
title: "Meterological Source Comparison"
Subtitle: "Overview"
format: html
params:
  lake_name: "Lake Rotorua"
  lat: -38.051408
  lon: 176.1616
  buffer_km: 10
---

## Objective

To analyse different meterological data avalable for a given location.

## Data sources

note add what kindof lat long system used\_\_\_\_\_

Limnotrack Buoy on lake, NIWA virtual climate station network (VCSN) , ERA5 statlite data, Observational data "Airport" station, Obresvational data "Town" station.

Data source and station names will vary from location to location. Selecting stations from these websites is laid out in the data wrangling section

## Outputs

The outputs of this project will show:

1.  Correlation coeficient (Pearsons r)

2.  Change in intercept and slope (linear regrassion slope and intercept)

3.  Mean absolute error (MAE)

4.  Root mean squared error (RMSE)

5.  Concordance

6.  Mean and realitive bias

    These metrics along with plots and diagnostics will answer bias questions, seasonal behaviour, event disagreement and extremes

## Study area

```{r}
library(leaflet)

# Interactive overview map centred on the lake
leaflet() |>
  addTiles() |>
  addCircles(
    lng = params$lon,
    lat = params$lat,
    radius = params$buffer_km * 1000,
    color = "dodgerblue",
    fillOpacity = 0.25,
    popup = params$lake_name
  ) |>
  addCircleMarkers(
    lng = params$lon,
    lat = params$lat,
    radius = 6,
    color = "navy",
    fillOpacity = 0.9,
    popup = params$lake_name
  ) |>
  setView(lng = params$lon, lat = params$lat, zoom = 11)
```

## Polygon and plot

```{r}
library(osmdata)
library(sf)
library(tmap)

# Download nearby water polygons and plot as a static reference map
bb <- c(
  params$lon - 0.1,
  params$lat - 0.1,
  params$lon + 0.1,
  params$lat + 0.1
)

osm_lake <- opq(bbox = bb) |>
  add_osm_feature(key = "natural", value = "water") |>
  osmdata_sf()

lake_poly <- osm_lake$osm_multipolygons |>
  st_make_valid()

tmap_mode("plot")

tm_shape(lake_poly) +
  tm_fill(col = "steelblue", alpha = 0.6) +
  tm_borders(col = "black") +
  tm_layout(
    title = params$lake_name,
    frame = FALSE
  )
```

Rotorua Lake, North Island, New Zealand