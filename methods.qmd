---
title: "Methods"
subtitle: "Data wrangle"
format: html
---

This section documents how the meteorological datasets were prepared, aligned, and compared so the workflow is transparent and repeatable.

## Data harmonisation units and time step

We used four sources: ERA5 reanalysis, buoy in-situ station, airport observations, and NIWA Virtual Climate Station Network (VCSN). All inputs were standardised to a daily time step and common units before any comparisons:

- Temperature (°C), wind speed (m/s), and shortwave radiation (W/m²) were aggregated as daily means; precipitation (mm) as daily totals.
- Sub-daily records (e.g., 5‑minute buoy, hourly stations) were first converted to UTC, then aggregated with sums for fluxes (precip) and means for state variables (temp, wind, radiation).
- Radiation in energy units (MJ/m²) was converted to power (W/m²) using `Rad_MJm2 * 1e6 / 86400` for daily totals and `* 1e6 / 3600` (hourly) before daily means, matching the reporting interval.
- Variable names were standardised to `Temp_C`, `Precip_mm`, `Wind_Spd_ms`, `RadSWD_Wm2`, plus a `Date` column for joins.

## Reference site justification

Airport station data were used as the primary reference because they are maintained, quality-controlled, and co-located near the lake with minimal missingness. All alternative sources (ERA5, VCSN, buoy, Town) were evaluated against this reference over their overlapping dates.

## Metrics 

Performance was quantified with Pearson correlation (r), regression slope and intercept (sim ~ obs), mean absolute error (MAE), root mean squared error (RMSE), Lin’s concordance correlation coefficient (CCC), bias (sim − obs), and relative bias (percent of observed mean). Metrics are computed after dropping NA pairs.

## Wet/windy subsets and logic

- **Wet days:** Precipitation metrics were recomputed on days with observed precip above a threshold (default 0.1–1 mm) to avoid zero-inflation masking disagreement.
- **Windy days:** Wind metrics were optionally recomputed for high-wind conditions, defined either by a fixed threshold (default 10 m/s) or by the top 10% of observed winds in the reference record.

These subsets surface performance during hydrologically and operationally important conditions.

## Data avalability / overlap

Only dates present in both the reference and the compared dataset are used. Coverage tables (rendered in the site) report first/last date and number of overlapping days for transparency.

## Rolling diagnostics logic

To detect drift through time, moving-window diagnostics (window = 30 days by default) track metrics such as bias and CCC. Plots of these rolling statistics help identify regime shifts, seasonal dependence, or gradual timing offsets.

## Limitations

- Spatial representativeness differs: point sensors (buoy, airport) capture local effects, while gridded/reanalysis products smooth extremes.
- Residual timestamp misalignment could affect daily aggregates despite UTC standardisation.
- Zero-inflated precipitation can inflate r; wet-day metrics mitigate but do not eliminate this effect.
- Findings depend on the overlapping period; results may change with different seasons or longer records.
- Wet/windy thresholds are pragmatic; sensitivity checks are recommended if thresholds influence decisions.

Future users should adapt thresholds, reference choice, and aggregation rules to their lake, documenting any deviations.
